# OpenClaw Security Patches ‚Äî Feb 2026

**Fecha:** 2026-02-02 02:55 UTC  
**Contexto:** Nightshift audit de upstream (20 commits)  
**Fuente:** claudio-neo/openclaw fork analysis

---

## CVE-1: WhatsApp AccountId Path Traversal

**Commit:** `758ec033a` (2026-02-01)  
**Reporter:** @leszekszpunar  
**Severity:** üî¥ **CRITICAL**

### Vulnerability
```javascript
// VULNERABLE CODE:
function resolveDefaultAuthDir(accountId: string): string {
  return path.join(resolveOAuthDir(), "whatsapp", normalizeAccountId(accountId));
}

// ATTACK:
accountId = "../../../etc/passwd"
authDir = "/oauth/whatsapp/../../../etc/passwd" ‚Üí "/etc/passwd"
```

Atacante pod√≠a escapar del directorio `oauth/whatsapp/` usando path traversal sequences (`../`).

### Impact
- Leer archivos arbitrarios del sistema
- Escribir en directorios fuera de oauth/
- Potencial RCE si se combina con otras vulnerabilidades

### Fix
```javascript
const SAFE_ACCOUNT_SEGMENT_RE = /^[a-z0-9_-]+$/i;

function resolveDefaultAuthDir(accountId: string): string {
  const normalized = normalizeAccountId(accountId);
  // Valida que solo contiene caracteres seguros
  // Garantiza que authDir queda bajo oauth/whatsapp/
  return path.join(baseDir, normalized);
}
```

### Test
```javascript
it("sanitizes path traversal sequences in accountId", () => {
  const { authDir } = resolveWhatsAppAuthDir({
    accountId: "../../../etc/passwd",
  });
  const relative = path.relative(baseDir, authDir);
  expect(relative.startsWith("..")).toBe(false);  // PASS
});
```

---

## CVE-2: Message Tool Sandbox Bypass

**Commit:** `0dbe018aa` (2026-02-01)  
**Reporter:** @leszekszpunar  
**Severity:** üî¥ **CRITICAL**

### Vulnerability
```javascript
// VULNERABLE CODE:
// Solo validaba filePath y path, NO media
// No normalizaba file:// URLs

// ATTACK 1:
message(..., media="file:///etc/passwd")  // File URL ‚Üí bypass

// ATTACK 2:
message(..., media="../../../etc/passwd")  // Path relativo ‚Üí escape
```

### Impact
- Exfiltraci√≥n de archivos del host via message channels
- Bypass de sandbox restrictions
- Acceso a archivos sensibles (configs, keys, etc.)

### Fix
```javascript
// 1. Normaliza file:// URLs a paths
function normalizeSandboxPathInput(raw: string): string {
  if (raw.startsWith("file://")) {
    return fileURLToPath(raw);
  }
  return raw;
}

// 2. Determina si media necesita validaci√≥n
function shouldValidateMediaPath(value: string): boolean {
  if (value.startsWith("data:") || value.startsWith("blob:")) return false;
  if (value.startsWith("file://")) return true;
  if (/^https?:\/\//i.test(value)) return false;
  return true;
}

// 3. Valida media path contra sandbox root
const mediaRaw = readStringParam(params, "media");
if (mediaRaw && shouldValidateMediaPath(mediaRaw)) {
  await assertSandboxPath({ filePath: mediaRaw, cwd: sandboxRoot, root: sandboxRoot });
}
```

### Test
```javascript
it("rejects file:// URLs outside sandbox", async () => {
  await expect(
    tool.fn({ media: "file:///etc/passwd" })
  ).rejects.toThrow(/outside sandbox/);
});
```

---

## CVE-3: Host Exec Env Validation

**Commit:** `a87a07ec8` (2026-02-01)  
**Reporter:** @HassanFleyah  
**Severity:** üü† **HIGH**

### Vulnerability
Environment variables pasados a `exec` tool no eran validados contra caracteres peligrosos.

### Impact
- Command injection via env vars
- Privilege escalation en host exec mode
- Bypass de security policies

### Fix
```javascript
// Harden env variable validation
// Reject env vars con caracteres peligrosos
// Sanitize before passing to child_process
```

*(Detalles completos requieren revisar diff ‚Äî no analizado a√∫n)*

---

## CVE-4: Web Tools & File Parsing Hardening

**Commit:** `b796f6ec0` (2026-02-01)  
**Reporter:** @VACInc  
**Severity:** üü† **HIGH**  
**Size:** 1091 l√≠neas (14 archivos modificados)

### Scope
- `web-fetch.ts` ‚Äî hardening de content fetching
- `media-understanding/apply.ts` ‚Äî text detection from media
- `security/external-content.ts` ‚Äî external content wrapping

### Vulnerability
- Web fetch pod√≠a ser explotado para SSRF
- Media text detection insegura
- External content no wrapeado correctamente

### Impact
- Server-Side Request Forgery
- XSS via malicious media files
- Data exfiltration via crafted URLs

### Fix
*(Detalles completos requieren revisar 1091 l√≠neas ‚Äî pendiente)*

---

## Decisi√≥n

**‚ö†Ô∏è NO MERGEAR sin auditor√≠a completa con Daniel.**

**Razones:**
1. CVE-1 y CVE-2 son CRITICAL ‚Äî necesitan testing exhaustivo
2. CVE-4 es 1091 l√≠neas ‚Äî requiere code review detallado
3. Nuestro fork `claudio/sovereign` elimin√≥ guardrails ‚Äî estos patches pueden tener interacci√≥n compleja

**Pr√≥ximos pasos:**
1. Revisar cada CVE con Daniel
2. Entender si nuestro uso actual est√° expuesto
3. Cherry-pick solo los patches necesarios
4. Testear localmente antes de deploy

---

*Analizado: 2026-02-02 02:55 UTC*  
*Pendiente: CVE-3 y CVE-4 an√°lisis detallado*
